/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package GetFile;


import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.net.URL;
import java.net.URLConnection;
import java.nio.file.Paths;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.swing.JFileChooser;



@WebServlet("/GetFile")

// file:c:/Users/hosoe/OneDrive/Documents/Hand-en.jpg課題1これでためす。
public class GetFile extends HttpServlet {

	protected void doPost(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException {

		//
		String input_URL = request.getParameter("URL");

    	// ダウンロードする URL
    	URL url = new URL(input_URL);
    	String fileName = Paths.get(url.getPath()).getFileName().toString();

        // 保存ダイアログの表示
        JFileChooser filechooser = new JFileChooser(fileName);
        // デフォルトのファイル名を指定
        filechooser.setSelectedFile(new File(fileName));
        // 保存ダイアログを表示
        if (filechooser.showSaveDialog(null) != JFileChooser.APPROVE_OPTION) {
          // 「保存」以外を押されたら終了
          return;
        }

        File saveFile = filechooser.getSelectedFile();

    	URLConnection conn = url.openConnection();//URLConnectionクラスのメソッドをみる
    	InputStream in = conn.getInputStream();//データを取る準備

    	File file = new File(saveFile); // 保存先
    	FileOutputStream out = new FileOutputStream(file, false);//データを書き出す」準備
    	byte[] bytes = new byte[512];//
    	while(true){
    	    int ret = in.read(bytes);
    	    if(ret <= 0) break;
    	    out.write(bytes, 0, ret);//0～255まで書き出す
    	}

    	out.close();
    	in.close();
    	response.sendRedirect("http://localhost:8080/GetFile/index.jsp");
    }
}
